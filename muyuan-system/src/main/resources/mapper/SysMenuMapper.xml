<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.muyuan.system.infrastructure.persistence.dao.SysMenuMapper">


    <select id="selectMenuPermissionByRoleNames" resultType="java.lang.String">
        select perms from (
                              select perms,id from t_sys_menu where type = 'F'
                          ) menu
                              left join  (
            select * from t_sys_role_menu
        ) role_menu on menu.id  = role_menu.menu_id
                              left join (
            select id from t_sys_role where name in
                                  <foreach collection="roleNames" open="(" close=")" item="item" >
                                      #{item}
                                  </foreach>
        ) role on role.id = role_menu.role_id
    </select>
    <select id="selectMenuByRoleNames" resultType="com.muyuan.system.domain.model.SysMenu">
        select menu.* from (
        select * from t_sys_menu where type in ('M','C') order by order_num
        ) menu
        inner join  (
        select * from t_sys_role_menu
        ) role_menu on menu.id  = role_menu.menu_id
        inner join (
        select id from t_sys_role where code in
        <foreach collection="roleNames" open="(" close=")" item="item" >
            #{item}
        </foreach>
        ) role on role.id = role_menu.role_id
    </select>
    <select id="selectMenuByRoleId" resultType="com.muyuan.system.domain.model.SysMenu">
        select menu.* from (
        select * from t_sys_menu order by order_num
        ) menu
        inner join  (
        select * from t_sys_role_menu  where role_id in
        <foreach collection="roleIds" open="(" close=")" item="item" >
            #{item}
        </foreach>
        ) role_menu on menu.id  = role_menu.menu_id
    </select>
</mapper>